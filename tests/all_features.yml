---
# All Modules & Modules

configs:
  serviceA:
    use_alb: True
    is_public: True
    use_nlb: True
    ext_sources:
      - ipv4: 0.0.0.0/0
        protocol: tcp
        source_name: all
      - ipv4: 1.1.1.1/32
        protocol: icmp
        source_name: GoogleDns

  serviceB:
    is_public: True
    use_nlb: False
    use_alb: True

  serviceC:
    is_public: False
    use_cloudmap: True

  globals:
    network:
      use_cloudmap: True

services:
  serviceA:
    image: nginx
    ports:
      - 80

  serviceB:
    image: nginx
    ports:
      - 80:80
    links:
      - serviceC

  serviceC:
    image: nginx


x-tags:
  - name: costcentre
    value: lambda-my-aws
  - name: mail
    value: john@lambda-my-aws.io

x-sqs:
  Queue02:
    Services:
      - name: serviceA
        access: RWPermissions
      - name: serviceB
        access: RO
    Properties:
      RedrivePolicy:
        deadLetterTargetArn: Queue01
        maxReceiveCount: 10
    Settings:
      EnvNames:
        - APP_QUEUE
        - AppQueue

  Queue01:
    Services:
      - name: serviceB
        access: RWMessages
    Properties: {}
    Settings:
      EnvNames:
        - DLQ
        - dlq

  QueueNoServices:
    Properties: {}
    Settings:
      EnvNames:
        - ALONE
        - NoOneLikesMe

x-rds:
  dbA:
    Properties:
      Engine: "aurora-mysql"
      EngineVersion: "5.7.12"
    Services:
      - name: serviceA
        access: RW

  dbB:
    Properties:
      Engine: "aurora-mysql"
      EngineVersion: "5.7.12"
    Services:
      - name: serviceA
        access: RW
      - name: serviceB
        access: RW
